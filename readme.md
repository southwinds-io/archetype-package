# Artisan Package Archetype

Use this archetype as the basis to build a new package.
The archetype can be built and shows the basic structure of a fully functional package.
Note that you can define your own structure, this archetype is one possible layout for a package project,
and it is offered as a good practice example.

> *Change the code inside to suit your needs. Know you can use any tools or automation you want.
Comments have been added to the code explaining the key concepts.
Artisan is just a vehicle to ship your logic in a standard, secure and edge friendly way.*

## Building the package

### Clone the repository

```bash
$ git clone https://github.com/southwinds-io/archetype-package <project-name>
```

### Building the package

To build the package use the ready made function in the root build file:

```bash
$ art run build
```

> NOTE the use of `run` to run functions in a build.yaml file directly, as opposed to `exe` used below to call functions in built packages.

If you know docker, artisan works in a similar way, in regard to tagging, pulling, pushing and building operations.

### Listing the package

To see the package that has just been built run the following command:

```bash
$ art ls
```

### Listing the package API

To see the package API run the following command:

``` bash
$ art man fx localhost:8082/test/archetype:1.0
```

you should see the following aoutput:

| NAME               | DESC | NET | INPUTS |
|--------------------|---|---|---|
| say-message | this function is a test stub to show str | []  | 1  |
| say-hello | calls an external bash script to print a | []  | 0      |
| who-am-i | this is an example of how to invoke an i | []  | 0      |
| say-hello-polyglot | shows how to call many commands in multi | []  | 0      |


### Running functions on the package

**Passing parameters via exported variable**

The following command executes the `say-message` function and sets the `MESSAGE` variable value inline, changing its value on different runs:

```sh
$ MESSAGE=HELLO art exe localhost:8082/test/archetype:1.0 say-message
2023/08/26 09:42:37.992823 ART INFO: HELLO

$ MESSAGE=HOLA art exe localhost:8082/test/archetype:1.0 say-message
2023/08/26 09:42:38.754462 ART INFO: HOLA

$ MESSAGE=HALLO art exe localhost:8082/test/archetype:1.0 say-message
2023/08/26 09:42:39.823412 ART INFO: HALLO
```

**Passing parameters via env file**

Alternatively, artisan can auto load variables from a .env file.
The file can be generated by artisan as follows:

```sh
$ art env package localhost:8082/test/archetype:1.0 say-message -f say-message.env
```

a file as follows will be generated in the current folder:

*say-message.env*
```env 
# ===================================================
# environment configuration file generated by artisan
# ===================================================
# VARIABLES
# ---------
# a message to print to stdout
MESSAGE=""
```

edit the file and add a value to `MESSAGE`, for example as shown:

*say-message.env*
```env 
# ===================================================
# environment configuration file generated by artisan
# ===================================================
# VARIABLES
# ---------
# a message to print to stdout
MESSAGE="How are you doing today?"
```

now run the following command:

```
$ art exe localhost:8082/test/archetype:1.0 say-message -e say-message.env
2023/08/26 10:05:48.449479 ART INFO: "How are you doing today?"
```

**Functions without inputs**

Functions without input can be called simply as follows:

```sh
$ art exe localhost:8082/test/archetype:1.0 say-hello
$ 2023/08/26 10:30:23.310411 ART INFO: Hello World!

$ art exe localhost:8082/test/archetype:1.0 who-am-i
$ 2023/08/26 10:30:52.797623 ART INFO: I am joe.blogs

$ art exe localhost:8082/test/archetype:1.0 say-hello-polyglot
$ 2023/08/26 10:33:42.828695 ART INFO: hello!
$ 2023/08/26 10:33:42.831021 ART INFO: hola!
$ 2023/08/26 10:33:42.833002 ART INFO: salut!
$ 2023/08/26 10:33:42.834972 ART INFO: hallo!
```